<Window x:Class="lab2.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:lab2"
        xmlns:vm="clr-namespace:lab2.ViewModels"
        mc:Ignorable="d"
        Title="MainWindow"
        Height="450"
        Width="800">
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>
    <Window.Resources>
        <Style TargetType="TextBox">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Padding"
                    Value="5" />
            <Setter Property="FontFamily"
                    Value="Consolas" />
        </Style>
        <Style TargetType="Button">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Padding"
                    Value="10,5" />
            <Setter Property="MinWidth"
                    Value="100" />
        </Style>
        <Style TargetType="Label">
            <Setter Property="Margin"
                    Value="5,5,5,0" />
            <Setter Property="FontWeight"
                    Value="Bold" />
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Padding"
                    Value="5" />
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <ScrollViewer Grid.Column="0"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="10">
                <Label Content="Конструктор фрагмента программы"
                       FontSize="16"
                       FontWeight="Bold" />
                <Label Content="Выберите пример:" />
                <ComboBox ItemsSource="{Binding Presets}"
                          SelectedItem="{Binding SelectedPreset}"
                          DisplayMemberPath="Name" />
                <TextBlock Text="{Binding SelectedPreset.Description}"
                           TextWrapping="Wrap"
                           Margin="5"
                           FontStyle="Italic"
                           Visibility="{Binding SelectedPreset, Converter={x:Static local:Converters.NullToVisibilityConverter}}" />
                <Label Content="Код программы (без циклов):" />
                <TextBox Text="{Binding CodeInput, UpdateSourceTrigger=PropertyChanged}"
                         Height="100"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto" />
                <TextBlock Text="Синтаксис: присваивание (x := expr), условие (if (B) { S1 } else { S2 }), последовательность (S1; S2)"
                           FontSize="10"
                           Foreground="Gray"
                           TextWrapping="Wrap"
                           Margin="5,0" />
                <Label Content="Постусловие (цель):" />
                <TextBox Text="{Binding PostconditionInput, UpdateSourceTrigger=PropertyChanged}"
                         Height="40"
                         TextWrapping="Wrap" />

                <TextBlock Text="Примеры: x > 15, max > 100, y == x - 9 &amp;&amp; x > 15"
                           FontSize="10"
                           Foreground="Gray"
                           TextWrapping="Wrap"
                           Margin="5,0" />
                <Label Content="Описание цели человеческим языком (опционально):" />
                <TextBox Text="{Binding PostconditionHumanInput, UpdateSourceTrigger=PropertyChanged}"
                         Height="40"
                         TextWrapping="Wrap" />
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Margin="10">
                    <Button Content="Рассчитать WP"
                            Command="{Binding CalculateWpCommand}"
                            IsEnabled="{Binding IsCalculating, Converter={x:Static local:Converters.InverseBoolConverter}}" />
                    <Button Content="Показать триаду"
                            Command="{Binding ShowTripleCommand}" />
                    <Button Content="Очистить"
                            Command="{Binding ClearCommand}" />
                </StackPanel>
                <ProgressBar IsIndeterminate="{Binding IsCalculating}"
                             Height="5"
                             Margin="5"
                             Visibility="{Binding IsCalculating, Converter={x:Static local:Converters.BoolToVisibilityConverter}}" />
            </StackPanel>
        </ScrollViewer>
        <ScrollViewer Grid.Column="1"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="10">
                <Label Content="Результат вычисления WP"
                       FontSize="16"
                       FontWeight="Bold" />
                <Border BorderBrush="Red"
                        BorderThickness="2"
                        Margin="5"
                        Padding="10"
                        Visibility="{Binding CurrentResult.HasErrors, Converter={x:Static local:Converters.BoolToVisibilityConverter}}">
                    <StackPanel>
                        <Label Content="Ошибка:"
                               Foreground="Red" />
                        <TextBlock Text="{Binding CurrentResult.ErrorMessage}"
                                   TextWrapping="Wrap"
                                   Foreground="Red" />
                    </StackPanel>
                </Border>
                <ItemsControl ItemsSource="{Binding CurrentResult.Steps}"
                              Visibility="{Binding CurrentResult.HasErrors, Converter={x:Static local:Converters.InverseBoolToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="LightBlue"
                                    BorderThickness="1"
                                    Margin="5"
                                    Padding="10"
                                    Background="AliceBlue">
                                <StackPanel>
                                    <Label Content="{Binding Description}"
                                           FontWeight="Bold"
                                           Foreground="DarkBlue" />
                                    <TextBlock Text="{Binding StatementProcessed}"
                                               FontFamily="Consolas"
                                               Margin="5,0"
                                               Background="White"
                                               Padding="5" />
                                    <TextBlock Text="{Binding IntermediatePredicate}"
                                               FontFamily="Consolas"
                                               Margin="5,0"
                                               FontWeight="Bold" />
                                    <TextBlock Text="{Binding HumanReadable}"
                                               TextWrapping="Wrap"
                                               Margin="5,0"
                                               Foreground="DarkGreen" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Border BorderBrush="Green"
                        BorderThickness="3"
                        Margin="5"
                        Padding="15"
                        Background="LightGreen"
                        Visibility="{Binding CurrentResult.FinalPrecondition, Converter={x:Static local:Converters.NullToVisibilityConverter}}">
                    <StackPanel>
                        <Label Content="Итоговое слабейшее предусловие:"
                               FontWeight="Bold"
                               FontSize="14" />
                        <TextBlock Text="{Binding CurrentResult.FinalPrecondition}"
                                   FontFamily="Consolas"
                                   FontSize="14"
                                   FontWeight="Bold"
                                   TextWrapping="Wrap"
                                   Background="White"
                                   Padding="10"
                                   Margin="0,5" />
                        <TextBlock Text="{Binding CurrentResult.FinalPrecondition.ToHumanReadable}"
                                   TextWrapping="Wrap"
                                   FontStyle="Italic"
                                   Foreground="DarkGreen" />
                    </StackPanel>
                </Border>
                <TextBlock Text="Введите код программы и постусловие, затем нажмите 'Рассчитать WP'"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontStyle="Italic"
                           Foreground="Gray"
                           Margin="50"
                           Visibility="{Binding CurrentResult, Converter={x:Static local:Converters.NullToVisibilityConverter}, ConverterParameter=Inverse}" />
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
